---
sidebar_position: 3
title: "🧠 RAG（检索增强生成）故障排除"
---

检索增强生成（RAG）使语言模型能够通过检索相关信息并将其输入模型来推理外部内容——文档、知识库等。但当事情不按预期工作时（例如，模型"产生幻觉"或遗漏相关信息），这通常不是模型的错——而是上下文问题。

让我们分解常见原因和解决方案，以便您可以提升您的 RAG 准确性！🚀

## 常见 RAG 问题及其解决方法 🛠️

### 1. 模型"看不到"您的内容 👁️❌

这是最常见的问题——通常是由于内容摄取过程中的问题引起的。模型产生幻觉不是因为它错了，而是因为它一开始就没有得到正确的内容。

✅ 解决方案：检查您的内容提取设置

- 导航至：**管理设置 > 文档**。
- 确保您使用的是强大的内容提取引擎，如：
  - Apache Tika
  - Docling
  - 自定义提取器（取决于您的文档类型）

📌 提示：尝试上传文档并预览提取的内容。如果它是空白的或缺少关键部分，您需要调整提取器设置或使用不同的引擎。

---

### 2. 只使用了文档的一小部分 📄➡️✂️

Open WebUI 默认设计为与具有有限上下文窗口的模型一起工作。例如，许多本地模型（如 Ollama 的默认模型）限制为 2048 个令牌。因此，Open WebUI 会积极裁剪检索到的内容，以适应假定的可用空间。

✅ 解决方案：

- 转到 **管理设置 > 文档**
- 可以：
  - 💡 启用"绕过嵌入和检索"——这直接发送完整内容，而不应用严格的检索过滤器。
  - 🔍 开启"完整上下文模式"——这将更全面的内容注入到模型提示中。

📌 警告：注意上下文限制——如果您的模型无法处理更多令牌，它仍然会被截断。

---

### 3. 令牌限制太短 ⏳

即使检索正常工作，您的模型可能仍然无法处理它接收的所有内容——因为它根本无法处理。

默认情况下，许多模型（特别是 Ollama 托管的 LLM）限制为 2048 个令牌的上下文窗口。这意味着只有一小部分检索到的数据会被实际使用。

✅ 解决方案：

- 🛠️ 扩展模型的上下文长度：
  - 导航到**模型编辑器或聊天控制**
  - 修改上下文长度（例如，如果支持，增加到 8192+ 令牌）

ℹ️ 注意：2048 个令牌的默认值是一个很大的限制。为了获得更好的 RAG 结果，我们建议使用支持更长上下文的模型。

✅ 替代方案：使用具有更大上下文容量的外部 LLM

- 尝试 GPT-4、GPT-4o、Claude 3、Gemini 1.5 或具有 8k+ 上下文的 Mixtral
- 与 Ollama 比较性能——当可以注入更多内容时，注意准确性差异！

📌 提示：在生产用例中，坚持使用外部模型以获得更好的 RAG 性能。

---

### 4. 嵌入模型质量低或不匹配 📉🧠

糟糕的嵌入 = 糟糕的检索。如果您内容的向量表示很差，检索器将无法拉取正确的内容——无论您的 LLM 多么强大。

✅ 解决方案：

- 更换为高质量嵌入模型（例如，all-MiniLM-L6-v2、Instructor X 或 OpenAI 嵌入）
- 转到：**管理设置 > 文档**
- 更改模型后，请确保：
  - ⏳ 重新索引所有现有文档，使新嵌入生效。

📌 记住：嵌入质量直接影响检索的内容。

---

### 5. ❌ 400: 'NoneType' object has no attribute 'encode'

此错误表示嵌入模型配置错误或缺失。当 Open WebUI 尝试创建嵌入但没有加载有效模型时，它无法处理文本——结果就是这个神秘的错误。

💥 原因：
- 您的嵌入模型设置不正确。
- 它可能没有完全下载。
- 或者如果您使用的是外部嵌入模型，它可能无法访问。

✅ 解决方案：

- 转到：**管理设置 > 文档 > 嵌入模型**
- 再次保存嵌入模型——即使它已经被选中。这会强制重新检查/下载。
- 如果您使用的是远程/外部嵌入工具，确保它正在运行并且 Open WebUI 可以访问。

📌 提示：修复配置后，尝试重新嵌入文档并验证日志中没有显示错误。

---

## 🧪 专业提示：使用 GPT-4o 或 GPT-4 测试

如果您不确定问题是出在检索、令牌限制还是嵌入上——尝试临时使用 GPT-4o（例如，通过 OpenAI API）。如果结果突然变得更准确，这是一个强烈的信号，表明您的本地模型的上下文限制（Ollama 中默认为 2048）是瓶颈。

- GPT-4o 处理更大的输入（128k 令牌！）
- 提供了一个很好的基准来评估您系统的 RAG 可靠性

---

## 总结检查表 ✅

| 问题 | 解决方法 |
|--------|------|
| 🤔 模型"看不到"内容 | 检查文档提取器设置 |
| 🧹 只使用了部分内容 | 启用完整上下文模式或绕过嵌入 |
| ⏱ 受 2048 令牌上限限制 | 增加模型上下文长度或使用大上下文 LLM |
| 📉 检索不准确 | 切换到更好的嵌入模型，然后重新索引 |
| 仍然困惑？ | 使用 GPT-4o 测试并比较输出 |

---

通过优化这些领域——提取、嵌入、检索和模型上下文——您可以显著提高 LLM 处理文档的准确性。不要让 2048 个令牌的窗口或弱检索管道限制您的 AI 能力 🎯。